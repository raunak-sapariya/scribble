{%load static%}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="{%static 'homepage/homepage.css'%}">
  <script src="{%static 'homepage/homepage.js'%}"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
  <div id="nav-bar">
    <input id="nav-toggle" type="checkbox">
    <div id="nav-header">
      <a id="nav-title" href="/" target="_blank">
        SCRIBBLE
      </a>
      <label for="nav-toggle">
        <a id="nav-toggle-burger"></a>
      </label>
      <hr>
    </div>
    <div id="nav-content">
      <div class="nav-button">
        <i class="fas fa-palette"></i><a>Home</a>
      </div>
      <a href="explore/">
      <div class="nav-button">
        <i class="fas fa-images"></i>Explore
      </div>
    </a>
      <div class="nav-button">
        <i class="fas fa-thumbtack"></i><a>Saved Post</a>
      </div>
      <hr>
      <div class="nav-button">
        <i class="fas fa-heart"></i><a>Like</a>
      </div>
      <div class="nav-button">
        <i class="fas fa-chart-line"></i><a>Trending</a>
      </div>
      <a href="message/"></a>
      <div class="nav-button">
        <i class="fas fa-fire"></i>Message
      </div>
    </a>
      <div class="nav-button">
        <i class="fas fa-magic"></i><a href="http://localhost:3000/post">Create Post</a>
      </div>
      <hr>

      <div id="nav-content-highlight"></div>
    </div>
    <input id="nav-footer-toggle" type="checkbox">
    <div id="nav-footer">
      <div id="nav-footer-heading">
        <div id="nav-footer-avatar">
          <img src="{{user.}}">
        </div>
        <div id="nav-footer-titlebox">
          <a id="nav-footer-title" href="/profile/{{user}}" target="_blank">{{user}}</a>
        </div>

      </div>
    </div>
  </div>
  <div class="top-bar">

    <a id="top-title" href="/" target="_blank">
      <p>SCRIBBLE</p>
    </a>

    <div>
      <a id="nav-icons" href="/" target="_blank">
        <i class="fa fa-plus"></i>
      </a>
      <a id="nav-icons" href="/" target="_blank">
        <i class="fa fa-message"></i>
      </a>
    </div>
  </div>

  </div>
  <nav class="bottom-bar">
    <a class="active" href="#">
      <svg viewBox="0 0 100 100">
        <g transform="translate(10 5) scale(0.8 0.9)">
          <path d="M 0 30 v 70 h 100 v -70 l -50 -30 z" stroke="currentColor" stroke-width="10" fill="none"
            stroke-linejoin="round" stroke-linecap="round" />
        </g>
      </svg>
      <span>
        Home
      </span>
    </a>

    <a href="#">
      <svg viewBox="0 0 100 100">
        <g transform="translate(5 5) scale(0.9 0.9)">
          <path d="M 50 35 a 20 20 0 0 1 50 0 q 0 25 -50 60 q -50 -35 -50 -60 a 25 25 0 0 1 50 0" stroke="currentColor"
            stroke-width="10" fill="none" stroke-linejoin="round" stroke-linecap="round" />
        </g>
      </svg>
      <span>
        Likes
      </span>
    </a>

    <a href="#">
      <svg viewBox="0 0 100 100">
        <g transform="translate(5 5) scale(0.9 0.9)">
          <circle cx="45" cy="38" r="38" stroke="currentColor" stroke-width="10" fill="none" />
          <line x1="66" y1="65" x2="100" y2="100" stroke="currentColor" stroke-width="10" />
        </g>
      </svg>
      <span>
        Search
      </span>
    </a>

    <a href="#">
      <svg viewBox="0 0 100 100">
        <g transform="translate(5 5) scale(0.9 0.9)">
          <circle cx="50" cy="35" r="18" stroke="currentColor" stroke-width="10" fill="none" />
          <rect x="15" y="75" width="70" height="50" rx="25" stroke="currentColor" stroke-width="10" fill="none" />
        </g>
      </svg>
      <span>
        Profile
      </span>
    </a>
  </nav>

  <div class="posts">
    {%for post in posts %}
    <div class="album box">
      <div class="status-main">
        <img src={{post.user}} class="status-img" />
        <div class="album-detail">
          <div class="album-title"><strong>{{post.user}}</strong></div>
          <div class="album-date">6 hours ago</div>
        </div>
        <button class="intro-menu"></button>
      </div>
      <div class="album-content">{{post.content}}

        <img src={{post.image_url}} alt="" class="album-photo" />
      </div>
      <div class="album-actions">
        <button onclick="likeImg({{post.id}})" clbuttonss="album-action" class="adding_transparent_background" style="background: transparent;border: none;">
          {% if post.is_liked %}
          <svg height="50px" width="50px"version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
           viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" 
           stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g>
             <path fill="#394240" d="M48,5c-4.418,0-8.418,1.793-11.312,4.688L32,14.344l-4.688-4.656C24.418,6.793,20.418,5,16,5 C7.164,5,0,12.164,0,21c0,
             4.418,2.852,8.543,5.75,11.438l23.422,23.426c1.562,1.562,4.094,1.562,5.656,0L58.188,32.5 C61.086,29.605,64,25.418,64,21C64,12.164,56.836,5,48,
             5z M32,47.375L11.375,26.75C9.926,25.305,8,23.211,8,21c0-4.418,3.582-8,8-8 c2.211,0,4.211,0.895,5.656,2.344l7.516,7.484c1.562,1.562,4.094,1.562,
             5.656,0l7.516-7.484C43.789,13.895,45.789,13,48,13 c4.418,0,8,3.582,8,8c0,2.211-1.926,4.305-3.375,5.75L32,47.375z"></path> 
            <path  id="likeButton-{{post.id}}" fill="red" d="M32,47.375L11.375,26.75C9.926,25.305,8,23.211,8,21c0-4.418,3.582-8,8-8c2.211,0,4.211,0.895,5.656,2.344 l7.516,7.484c1.562,1.562,
            4.094,1.562,5.656,0l7.516-7.484C43.789,13.895,45.789,13,48,13c4.418,0,8,3.582,8,8 c0,2.211-1.926,4.305-3.375,5.75L32,47.375z"></path> </g> </g></svg>
           {% else  %}
           <svg height="50px" width="50px"version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
           viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" 
           stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g>
             <path fill="#394240" d="M48,5c-4.418,0-8.418,1.793-11.312,4.688L32,14.344l-4.688-4.656C24.418,6.793,20.418,5,16,5 C7.164,5,0,12.164,0,21c0,
             4.418,2.852,8.543,5.75,11.438l23.422,23.426c1.562,1.562,4.094,1.562,5.656,0L58.188,32.5 C61.086,29.605,64,25.418,64,21C64,12.164,56.836,5,48,
             5z M32,47.375L11.375,26.75C9.926,25.305,8,23.211,8,21c0-4.418,3.582-8,8-8 c2.211,0,4.211,0.895,5.656,2.344l7.516,7.484c1.562,1.562,4.094,1.562,
             5.656,0l7.516-7.484C43.789,13.895,45.789,13,48,13 c4.418,0,8,3.582,8,8c0,2.211-1.926,4.305-3.375,5.75L32,47.375z"></path> 
            <path  id="likeButton-{{post.id}}" fill="none" d="M32,47.375L11.375,26.75C9.926,25.305,8,23.211,8,21c0-4.418,3.582-8,8-8c2.211,0,4.211,0.895,5.656,2.344 l7.516,7.484c1.562,1.562,
            4.094,1.562,5.656,0l7.516-7.484C43.789,13.895,45.789,13,48,13c4.418,0,8,3.582,8,8 c0,2.211-1.926,4.305-3.375,5.75L32,47.375z"></path> </g> </g></svg>
          {% endif %}


          <p id="imglikeCount-{{post.id}}">{{post.like_count}}</p>
        </button>
        <a href="#" class="album-action">
          <svg stroke="currentColor" stroke-width="2" fill="red" stroke-linecap="round" stroke-linejoin="round"
            class="css-i6dzq1" viewBox="0 0 24 24">
            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" />
          </svg>
          {{post.comment_count}}
        </a>
        <a href="#" class="album-action">
          <svg stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"
            class="css-i6dzq1" viewBox="0 0 24 24">
            <path d="M17 1l4 4-4 4" />
            <path d="M3 11V9a4 4 0 014-4h14M7 23l-4-4 4-4" />
            <path d="M21 13v2a4 4 0 01-4 4H3" />
          </svg>
        </a>
      </div>
    </div>


    {% endfor %}
  </div>

  <script>
    let checkbox = document.getElementById('nav-toggle');
    var targetDiv = document.querySelectorAll('.album');
    if (checkbox.checked) {
      targetDiv.forEach(e => e.style.marginLeft = "120px")
    } else {
      targetDiv.forEach(e => e.style.marginLeft = "300px")

    }
    checkbox.addEventListener('change', function () {
      if (checkbox.checked) {
        targetDiv.forEach(e => e.style.marginLeft = "120px")
      } else {
        targetDiv.forEach(e => e.style.marginLeft = "300px")

      }
    });
  </script>

  <script>
    const navigationOptions = [
      {
        name: 'home',
        color: '#5B37B7',
        bg: "#332968"

      },
      {
        name: 'likes',
        color: '#C9379D',
        bg: "#aa0084"

      },
      {
        name: 'search',
        color: '#E6A919',
        bg: "#d67700"
      },
      {
        name: 'profile',
        color: '#1892A6',
        bg: "#007179"
      }
    ];

    const links = document.querySelectorAll('nav a');

    function handleClick(e) {
      e.preventDefault();
      links.forEach(link => {
        if (link.classList.contains('active')) {
          link.classList.remove('active');
        }
      });

      const name = this.textContent.trim().toLowerCase();
      const { color, bg } = navigationOptions.find(item => item.name === name);

      const style = window.getComputedStyle(this);
      const hoverColor = style.getPropertyValue('--hover-c');
      if (color !== hoverColor) {
        this.style.setProperty('--hover-bg', `${color}20`);
        this.style.setProperty('--hover-c', color);
      }

      this.classList.add('active');
      document.querySelector('body').style.background = color;
      document.querySelector(".top-bar").style.background = bg
    }

    links.forEach(link => link.addEventListener('click', handleClick));
  </script>
  <script>
    let prevScrollPos = window.pageYOffset;

    window.onscroll = function () {
      let currentScrollPos = window.pageYOffset;

      if (prevScrollPos > currentScrollPos) {
        // Scrolling up, show the navbar
        document.querySelector(".top-bar").style.top = "0";
      } else {
        // Scrolling down, hide the navbar
        document.querySelector(".top-bar").style.top = "-200px";
      }

      prevScrollPos = currentScrollPos;
    }
  </script>


  <script>
    const likeImg = async (imgId) => {
      try {
        const res = await fetch('like-image', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imgId: imgId }),
        });
        const data = await res.json();
        
        
        if (res.ok) {
          const likeCount = document.getElementById("imglikeCount-"+imgId);
          const counter = parseInt(likeCount.innerText) ;
          const likeButton_color= document.getElementById("likeButton-"+imgId);
          console.log(likeButton_color)
          
          console.log(likeButton_color.attributes)
        
          if (data.status=="liked"){
            likeCount.innerText = counter+1;
            likeButton_color.style.fill="red";

        
          }
          else  if (data.status=="unliked"){
            likeCount.innerText = counter-1;
            likeButton_color.style.fill="none";
            
          }
        } else {
            // Handle error response
            console.error(data.error);
        }
    } catch (error) {
        console.error('Error:', error);
    }


    }
  </script>
</body>


</html>